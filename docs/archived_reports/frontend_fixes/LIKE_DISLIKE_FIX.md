# ğŸ”§ ç‚¹èµå’Œä¸å–œæ¬¢åŠŸèƒ½ä¿®å¤

## âœ… å·²ä¿®å¤çš„é—®é¢˜

**é—®é¢˜æè¿°**: ç‚¹èµå’Œä¸å–œæ¬¢æŒ‰é’®çš„åŠŸèƒ½æ²¡æœ‰å®ç°

**åŸå› åˆ†æ**:
1. åç«¯ `MediaActions` è§†å›¾çš„ POST æ–¹æ³•åªæ˜¯å¼‚æ­¥åˆ›å»ºè®°å½•ï¼Œä¸æ”¯æŒåˆ‡æ¢ï¼ˆå–æ¶ˆç‚¹èµ/å–æ¶ˆä¸å–œæ¬¢ï¼‰
2. åç«¯ GET æ–¹æ³•åªè¿”å›ä¸¾æŠ¥è®°å½•ï¼Œä¸è¿”å›ç”¨æˆ·çš„ç‚¹èµ/ä¸å–œæ¬¢çŠ¶æ€
3. åç«¯æ²¡æœ‰å®ç°äº’æ–¥é€»è¾‘ï¼ˆç‚¹èµå’Œä¸å–œæ¬¢åº”è¯¥æ˜¯äº’æ–¥çš„ï¼‰

## ğŸ› ï¸ ä¿®å¤å†…å®¹

### 1. åç«¯ä¿®å¤ï¼ˆå·²å®Œæˆï¼‰

**æ–‡ä»¶**: `files/views/media.py` - `MediaActions` ç±»

#### ä¿®æ”¹ 1: GET æ–¹æ³• - è¿”å›ç”¨æˆ·æ“ä½œçŠ¶æ€

**åŠŸèƒ½**: è¿”å›ç”¨æˆ·æ˜¯å¦å·²ç‚¹èµ/ä¸å–œæ¬¢

**ä¿®æ”¹åçš„é€»è¾‘**:
```python
def get(self, request, friendly_token, format=None):
    # å¯¹äºç™»å½•ç”¨æˆ·ï¼Œè¿”å›ï¼š
    # - user_liked: æ˜¯å¦å·²ç‚¹èµ
    # - user_disliked: æ˜¯å¦å·²æ ‡è®°ä¸ºä¸å–œæ¬¢  
    # - likes: æ€»ç‚¹èµæ•°
    # - dislikes: æ€»ä¸å–œæ¬¢æ•°
    
    # å¯¹äºåª’ä½“æ‰€æœ‰è€…/ç¼–è¾‘ï¼Œé¢å¤–è¿”å›ï¼š
    # - reported: ä¸¾æŠ¥è®°å½•åˆ—è¡¨
```

#### ä¿®æ”¹ 2: POST æ–¹æ³• - æ”¯æŒåˆ‡æ¢å’Œäº’æ–¥é€»è¾‘

**æ–°å¢åŠŸèƒ½**:
1. âœ… **åˆ‡æ¢é€»è¾‘**: ç‚¹å‡»å·²ç‚¹èµçš„æŒ‰é’® â†’ å–æ¶ˆç‚¹èµ
2. âœ… **äº’æ–¥é€»è¾‘**: ç‚¹èµæ—¶è‡ªåŠ¨å–æ¶ˆä¸å–œæ¬¢ï¼Œåä¹‹äº¦ç„¶
3. âœ… **åŒæ­¥å¤„ç†**: ç«‹å³è¿”å›ç»“æœï¼Œä¸ä½¿ç”¨å¼‚æ­¥ä»»åŠ¡
4. âœ… **è¿”å›çŠ¶æ€**: è¿”å› `action_type` å­—æ®µï¼ˆlike/unlike/dislike/undislikeï¼‰

**å®ç°çš„æ“ä½œæµç¨‹**:

##### ç‚¹èµæ“ä½œï¼ˆlikeï¼‰
```
æƒ…å†µ1: ç”¨æˆ·æœªç‚¹èµ
- æ£€æŸ¥æ˜¯å¦æœ‰ä¸å–œæ¬¢ â†’ å¦‚æœæœ‰ï¼Œåˆ é™¤ä¸å–œæ¬¢
- åˆ›å»ºç‚¹èµè®°å½•
- æ›´æ–°ç‚¹èµè®¡æ•°
- è¿”å›: action_type = "like"

æƒ…å†µ2: ç”¨æˆ·å·²ç‚¹èµ
- åˆ é™¤ç‚¹èµè®°å½•
- å‡å°‘ç‚¹èµè®¡æ•°
- è¿”å›: action_type = "unlike"
```

##### ä¸å–œæ¬¢æ“ä½œï¼ˆdislikeï¼‰
```
æƒ…å†µ1: ç”¨æˆ·æœªæ ‡è®°ä¸å–œæ¬¢
- æ£€æŸ¥æ˜¯å¦æœ‰ç‚¹èµ â†’ å¦‚æœæœ‰ï¼Œåˆ é™¤ç‚¹èµ
- åˆ›å»ºä¸å–œæ¬¢è®°å½•
- æ›´æ–°ä¸å–œæ¬¢è®¡æ•°
- è¿”å›: action_type = "dislike"

æƒ…å†µ2: ç”¨æˆ·å·²æ ‡è®°ä¸å–œæ¬¢
- åˆ é™¤ä¸å–œæ¬¢è®°å½•
- å‡å°‘ä¸å–œæ¬¢è®¡æ•°
- è¿”å›: action_type = "undislike"
```

**API å“åº”æ ¼å¼**:
```json
{
  "detail": "ç‚¹èµæˆåŠŸ",
  "action_type": "like",
  "action": "like",
  "media": "WO6ks1p1X"
}
```

---

## ğŸ§ª æµ‹è¯•ä¿®å¤

### æ­¥éª¤ 1: é‡å¯ Django æœåŠ¡å™¨

```bash
# åœ¨ Django ç»ˆç«¯æŒ‰ Ctrl+C åœæ­¢æœåŠ¡å™¨
# ç„¶åé‡æ–°å¯åŠ¨
python manage.py runserver
```

### æ­¥éª¤ 2: æµ‹è¯•åŠŸèƒ½

1. **è®¿é—®è§†é¢‘é¡µé¢**: http://localhost:8088/media/{token}

2. **æµ‹è¯•ç‚¹èµåŠŸèƒ½**:
   - â‘  ç‚¹å‡»ç‚¹èµæŒ‰é’® â†’ åº”è¯¥æ˜¾ç¤º"ç‚¹èµæˆåŠŸ"
   - â‘¡ å†æ¬¡ç‚¹å‡»ç‚¹èµæŒ‰é’® â†’ åº”è¯¥æ˜¾ç¤º"å·²å–æ¶ˆç‚¹èµ"
   - â‘¢ ç‚¹èµæ•°åº”è¯¥ç›¸åº”å¢åŠ /å‡å°‘

3. **æµ‹è¯•ä¸å–œæ¬¢åŠŸèƒ½**:
   - â‘  ç‚¹å‡»ä¸å–œæ¬¢æŒ‰é’® â†’ åº”è¯¥æ˜¾ç¤º"å·²æ ‡è®°ä¸ºä¸å–œæ¬¢"
   - â‘¡ å†æ¬¡ç‚¹å‡»ä¸å–œæ¬¢æŒ‰é’® â†’ åº”è¯¥æ˜¾ç¤º"å·²å–æ¶ˆä¸å–œæ¬¢æ ‡è®°"
   - â‘¢ ä¸å–œæ¬¢æ•°åº”è¯¥ç›¸åº”å¢åŠ /å‡å°‘

4. **æµ‹è¯•äº’æ–¥é€»è¾‘**:
   - â‘  å…ˆç‚¹å‡»ç‚¹èµ â†’ ç‚¹èµæ•° +1
   - â‘¡ å†ç‚¹å‡»ä¸å–œæ¬¢ â†’ ç‚¹èµæ•° -1ï¼Œä¸å–œæ¬¢æ•° +1
   - â‘¢ å†æ¬¡ç‚¹å‡»ç‚¹èµ â†’ ä¸å–œæ¬¢æ•° -1ï¼Œç‚¹èµæ•° +1

---

## ğŸ“Š åŠŸèƒ½å¯¹ç…§è¡¨

| æ“ä½œ | å½“å‰çŠ¶æ€ | æ‰§è¡ŒåçŠ¶æ€ | ç‚¹èµæ•°å˜åŒ– | ä¸å–œæ¬¢æ•°å˜åŒ– | è¿”å›å€¼ |
|------|---------|-----------|-----------|------------|--------|
| ç‚¹å‡»ç‚¹èµ | æ—  | å·²ç‚¹èµ | +1 | 0 | like |
| ç‚¹å‡»ç‚¹èµ | å·²ç‚¹èµ | æ—  | -1 | 0 | unlike |
| ç‚¹å‡»ç‚¹èµ | å·²ä¸å–œæ¬¢ | å·²ç‚¹èµ | +1 | -1 | like |
| ç‚¹å‡»ä¸å–œæ¬¢ | æ—  | å·²ä¸å–œæ¬¢ | 0 | +1 | dislike |
| ç‚¹å‡»ä¸å–œæ¬¢ | å·²ä¸å–œæ¬¢ | æ—  | 0 | -1 | undislike |
| ç‚¹å‡»ä¸å–œæ¬¢ | å·²ç‚¹èµ | å·²ä¸å–œæ¬¢ | -1 | +1 | dislike |

---

## ğŸ” å‰ç«¯å¦‚ä½•ä½¿ç”¨

å‰ç«¯ `MediaDetail.vue` å·²ç»æ­£ç¡®å®ç°ï¼Œä¸éœ€è¦ä¿®æ”¹ï¼š

```typescript
// ç‚¹èµåŠŸèƒ½
async function handleLike() {
  const response = await MediaAPI.createUserMediaAction(token.value, 'like')
  
  if (response.action_type === 'unlike') {
    // å–æ¶ˆç‚¹èµ
    userLiked.value = false
    detail.value.likes--
  } else {
    // ç‚¹èµ
    userLiked.value = true
    detail.value.likes++
    // å¦‚æœä¹‹å‰æœ‰ä¸å–œæ¬¢ï¼Œå–æ¶ˆä¸å–œæ¬¢çŠ¶æ€
    if (userDisliked.value) {
      userDisliked.value = false
      detail.value.dislikes--
    }
  }
}
```

---

## ğŸ¯ UI æ˜¾ç¤ºæ•ˆæœ

### æŒ‰é’®çŠ¶æ€

#### ç‚¹èµæŒ‰é’®
- **æœªç‚¹èµ**: â­ ç©ºå¿ƒæ˜Ÿæ˜Ÿ + æ•°å­—
- **å·²ç‚¹èµ**: â˜… å®å¿ƒæ˜Ÿæ˜Ÿï¼ˆè“è‰²ï¼‰+ æ•°å­—

#### ä¸å–œæ¬¢æŒ‰é’®
- **æœªæ ‡è®°**: ğŸ‘ æ™®é€šå›¾æ ‡ + æ•°å­—
- **å·²æ ‡è®°**: ğŸ‘ é«˜äº®å›¾æ ‡ï¼ˆè“è‰²ï¼‰+ æ•°å­—

### äº¤äº’åé¦ˆ

- ç‚¹å‡»åç«‹å³æ›´æ–°æŒ‰é’®çŠ¶æ€
- æ˜¾ç¤º ElementPlus æ¶ˆæ¯æç¤º
- æ•°å­—åŠ¨æ€æ›´æ–°

---

## ğŸ› å¦‚æœé—®é¢˜ä»ç„¶å­˜åœ¨

### æ£€æŸ¥æ¸…å•

1. [ ] Django æœåŠ¡å™¨å·²é‡å¯
2. [ ] å·²ç™»å½•ï¼ˆåŒ¿åç”¨æˆ·ä¸æ”¯æŒç‚¹èµ/ä¸å–œæ¬¢ï¼‰
3. [ ] æµè§ˆå™¨å·²åˆ·æ–°ï¼ˆCtrl+F5ï¼‰
4. [ ] æ£€æŸ¥æµè§ˆå™¨æ§åˆ¶å°æ˜¯å¦æœ‰é”™è¯¯
5. [ ] æ£€æŸ¥ Django æ—¥å¿—æ˜¯å¦æœ‰é”™è¯¯

### è°ƒè¯•æ­¥éª¤

#### 1. æ£€æŸ¥ API è¯·æ±‚

æ‰“å¼€æµè§ˆå™¨å¼€å‘è€…å·¥å…·ï¼ˆF12ï¼‰ï¼š

```
Network -> æ‰¾åˆ° POST /api/v1/media/{token}/actions è¯·æ±‚
-> Payload: { "type": "like" }
-> Response: åº”è¯¥åŒ…å« action_type å­—æ®µ
```

#### 2. æ£€æŸ¥å“åº”æ ¼å¼

æˆåŠŸçš„å“åº”åº”è¯¥æ˜¯ï¼š
```json
{
  "detail": "ç‚¹èµæˆåŠŸ",
  "action_type": "like",
  "action": "like",
  "media": "WO6ks1p1X"
}
```

#### 3. æ£€æŸ¥æ•°æ®åº“

```bash
# è¿›å…¥ Django shell
python manage.py shell
```

```python
from files.models import Media
from actions.models import MediaAction
from users.models import User

# æŸ¥çœ‹åª’ä½“çš„ç‚¹èµæ•°
media = Media.objects.get(friendly_token='WO6ks1p1X')
print(f"Likes: {media.likes}, Dislikes: {media.dislikes}")

# æŸ¥çœ‹ç”¨æˆ·çš„ç‚¹èµè®°å½•
user = User.objects.get(username='wal')
actions = MediaAction.objects.filter(user=user, media=media)
for action in actions:
    print(f"Action: {action.action}, Date: {action.action_date}")
```

---

## ğŸ’¡ æŠ€æœ¯ç»†èŠ‚

### ä¸ºä»€ä¹ˆåŒæ­¥å¤„ç†è€Œä¸æ˜¯å¼‚æ­¥ï¼Ÿ

**åŸå› **:
1. éœ€è¦ç«‹å³è¿”å› `action_type` ç»™å‰ç«¯
2. ç‚¹èµ/ä¸å–œæ¬¢æ“ä½œéœ€è¦æ£€æŸ¥ç°æœ‰çŠ¶æ€
3. ç”¨æˆ·æœŸæœ›ç«‹å³çœ‹åˆ°ç»“æœ

**å¼‚æ­¥å¤„ç†çš„ä¿ç•™**:
- ä¸¾æŠ¥ï¼ˆreportï¼‰æ“ä½œä»ç„¶ä½¿ç”¨å¼‚æ­¥
- è§‚çœ‹ï¼ˆwatchï¼‰æ“ä½œä»ç„¶ä½¿ç”¨å¼‚æ­¥
- åŒ¿åç”¨æˆ·çš„æ“ä½œä»ç„¶ä½¿ç”¨å¼‚æ­¥

### å¹¶å‘å®‰å…¨æ€§

ä½¿ç”¨ Django ORM çš„åŸå­æ“ä½œï¼š
```python
# ä½¿ç”¨ filter().first() ä»£æ›¿ get()
# ä½¿ç”¨ objects.create() ä»£æ›¿å…ˆæŸ¥è¯¢å†åˆ›å»º
# ä½¿ç”¨ delete() åˆ é™¤è®°å½•
# ä½¿ç”¨ update() æ›´æ–°è®¡æ•°ï¼ˆä¸è§¦å‘ post_save ä¿¡å·ï¼‰
```

### æ€§èƒ½ä¼˜åŒ–

- ä½¿ç”¨ `select_related()` é¢„åŠ è½½å…³è”å¯¹è±¡
- ä½¿ç”¨ `exists()` è€Œä¸æ˜¯ `count()` æ£€æŸ¥å­˜åœ¨æ€§
- ä½¿ç”¨ `filter().first()` è€Œä¸æ˜¯ `try-except get()`

---

## âœ… æ€»ç»“

**å·²ä¿®å¤**:
- âœ… ç‚¹èµ/å–æ¶ˆç‚¹èµåŠŸèƒ½
- âœ… ä¸å–œæ¬¢/å–æ¶ˆä¸å–œæ¬¢åŠŸèƒ½
- âœ… ç‚¹èµå’Œä¸å–œæ¬¢çš„äº’æ–¥é€»è¾‘
- âœ… ç”¨æˆ·æ“ä½œçŠ¶æ€çš„è·å–

**éœ€è¦æ“ä½œ**:
- âš ï¸ é‡å¯ Django æœåŠ¡å™¨

**é¢„è®¡æ—¶é—´**: 30 ç§’

ä¿®å¤å®Œæˆåï¼Œç‚¹èµå’Œä¸å–œæ¬¢æŒ‰é’®åº”è¯¥å®Œå…¨æ­£å¸¸å·¥ä½œï¼âœ¨

---

## ğŸ“š ç›¸å…³æ–‡ä»¶

ä¿®æ”¹çš„æ–‡ä»¶ï¼š
- âœ… `files/views/media.py` - MediaActions ç±»çš„ GET å’Œ POST æ–¹æ³•

ç›¸å…³æ–‡ä»¶ï¼ˆæœªä¿®æ”¹ï¼‰ï¼š
- `frontend-vue/src/views/MediaDetail.vue` - å‰ç«¯åª’ä½“è¯¦æƒ…é¡µ
- `frontend-vue/src/api/media.ts` - API è°ƒç”¨
- `actions/models.py` - MediaAction æ¨¡å‹

