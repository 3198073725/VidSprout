# MediaCMS Windows å¼€å‘ç¯å¢ƒå®Œæ•´æ­¥éª¤æ£€æŸ¥æ¸…å•

## ğŸ“‹ æ¦‚è¿°

æœ¬æ–‡æ¡£æ£€æŸ¥äº†æ‰€æœ‰é…ç½®æ­¥éª¤ï¼Œç¡®ä¿æ²¡æœ‰é—æ¼ä»»ä½•å…³é”®é…ç½®ã€‚è¯·æŒ‰é¡ºåºæ£€æŸ¥æ¯ä¸€é¡¹ã€‚

---

## âœ… é˜¶æ®µä¸€ï¼šç¯å¢ƒå‡†å¤‡ï¼ˆå·²å®Œæˆï¼‰

### 1.1 åŸºç¡€è½¯ä»¶å®‰è£…
- [x] Python 3.11+ å·²å®‰è£…å¹¶æ·»åŠ åˆ° PATH
- [x] Node.js 20.19.0+ å·²å®‰è£…
- [x] Git å·²å®‰è£…
- [x] PostgreSQL 15+ å·²å®‰è£…å¹¶è¿è¡Œ
- [x] Redis å·²å®‰è£…å¹¶è¿è¡Œï¼ˆWSL æˆ– Memuraiï¼‰
- [x] FFmpeg å·²å®‰è£…å¹¶æ·»åŠ åˆ° PATH
- [x] ImageMagick å·²å®‰è£…å¹¶æ·»åŠ åˆ° PATH

### 1.2 éªŒè¯ç¯å¢ƒ
```powershell
python --version    # åº”è¯¥æ˜¾ç¤º 3.11+
pip --version
node --version      # åº”è¯¥æ˜¾ç¤º 20.19.0+ æˆ– 22.12.0+
npm --version
psql --version      # åº”è¯¥æ˜¾ç¤º PostgreSQL ç‰ˆæœ¬
ffmpeg -version     # åº”è¯¥æ˜¾ç¤º FFmpeg ç‰ˆæœ¬
magick -version     # åº”è¯¥æ˜¾ç¤º ImageMagick ç‰ˆæœ¬
```

---

## âœ… é˜¶æ®µäºŒï¼šæ•°æ®åº“é…ç½®ï¼ˆéœ€è¦ç¡®è®¤ï¼‰

### 2.1 PostgreSQL æ•°æ®åº“å’Œç”¨æˆ·

**æ£€æŸ¥é¡¹ï¼š**
- [ ] PostgreSQL æœåŠ¡æ­£åœ¨è¿è¡Œ
- [ ] æ•°æ®åº“ `mediacms` å·²åˆ›å»º
- [ ] ç”¨æˆ· `mediacms` å·²åˆ›å»º
- [ ] ç”¨æˆ· `mediacms` å¯†ç ä¸º `mediacms`
- [ ] ç”¨æˆ· `mediacms` æ‹¥æœ‰æ•°æ®åº“ `mediacms` çš„æ‰€æœ‰æƒé™

**éªŒè¯å‘½ä»¤ï¼š**
```powershell
# æµ‹è¯•æ•°æ®åº“è¿æ¥
psql -U mediacms -d mediacms -h localhost
# è¾“å…¥å¯†ç ï¼šmediacms
# å¦‚æœæˆåŠŸè¿æ¥ï¼Œè¾“å…¥ \q é€€å‡º
```

**å¦‚æœå¤±è´¥ï¼Œè¿è¡Œï¼š**
```powershell
.\fix-postgres-password.bat
```

### 2.2 Redis é…ç½®

**æ£€æŸ¥é¡¹ï¼š**
- [ ] Redis æœåŠ¡æ­£åœ¨è¿è¡Œï¼ˆå¦‚æœä½¿ç”¨ WSLï¼š`wsl -e bash -c "sudo service redis-server start"`ï¼‰
- [ ] Redis ç›‘å¬ç«¯å£ 6379

**éªŒè¯å‘½ä»¤ï¼š**
```powershell
redis-cli ping
# åº”è¯¥è¿”å› PONG
```

---

## âœ… é˜¶æ®µä¸‰ï¼šPython åç«¯ç¯å¢ƒï¼ˆéƒ¨åˆ†å®Œæˆï¼‰

### 3.1 Python è™šæ‹Ÿç¯å¢ƒ

**æ£€æŸ¥é¡¹ï¼š**
- [x] è™šæ‹Ÿç¯å¢ƒå·²åˆ›å»ºï¼ˆ`venv/` ç›®å½•å­˜åœ¨ï¼‰
- [x] è™šæ‹Ÿç¯å¢ƒå·²æ¿€æ´»ï¼ˆå‘½ä»¤æç¤ºç¬¦å‰æœ‰ `(venv)` å‰ç¼€ï¼‰

**å¦‚æœæœªåˆ›å»ºï¼Œè¿è¡Œï¼š**
```powershell
python -m venv venv
.\venv\Scripts\Activate.ps1
```

### 3.2 Python ä¾èµ–å®‰è£…

**æ£€æŸ¥é¡¹ï¼š**
- [x] å·²ä½¿ç”¨ `requirements-windows.txt` å®‰è£…ä¾èµ–
- [x] `django-cors-headers` å·²å®‰è£…

**éªŒè¯å‘½ä»¤ï¼š**
```powershell
pip list | findstr django-cors-headers
# åº”è¯¥æ˜¾ç¤º django-cors-headers 4.7.0
```

### 3.3 æœ¬åœ°é…ç½®æ–‡ä»¶

**æ£€æŸ¥é¡¹ï¼š**
- [x] `cms/local_settings.py` å·²åˆ›å»º
- [x] `cms/local_settings.py` åŒ…å«æ•°æ®åº“é…ç½®
- [x] `cms/local_settings.py` åŒ…å« Redis é…ç½®
- [x] `cms/local_settings.py` åŒ…å« CORS é…ç½®
- [x] `cms/local_settings.py` æ­£ç¡®è¿½åŠ  `corsheaders` åˆ° `INSTALLED_APPS`
- [x] `cms/local_settings.py` æ­£ç¡®æ’å…¥ CORS ä¸­é—´ä»¶åˆ° `MIDDLEWARE`

**å…³é”®é…ç½®æ£€æŸ¥ï¼š**

æ‰“å¼€ `cms/local_settings.py`ï¼Œç¡®è®¤åŒ…å«ï¼š

```python
# CORS é…ç½®
try:
    if 'corsheaders' not in INSTALLED_APPS:
        INSTALLED_APPS.append('corsheaders')
except NameError:
    INSTALLED_APPS = ['corsheaders']

try:
    if 'corsheaders.middleware.CorsMiddleware' not in MIDDLEWARE:
        MIDDLEWARE.insert(0, 'corsheaders.middleware.CorsMiddleware')
except (NameError, AttributeError):
    MIDDLEWARE = ['corsheaders.middleware.CorsMiddleware']

CORS_ALLOWED_ORIGINS = [
    "http://localhost:8080",
    "http://127.0.0.1:8080",
]
CORS_ALLOW_CREDENTIALS = True
CORS_ALLOW_ALL_ORIGINS = True  # å¼€å‘ç¯å¢ƒ
```

### 3.4 æ•°æ®åº“è¿ç§» âš ï¸ **é‡è¦ï¼šéœ€è¦æ‰§è¡Œ**

**æ£€æŸ¥é¡¹ï¼š**
- [ ] æ•°æ®åº“è¿ç§»å·²å®Œæˆï¼ˆ`python manage.py migrate`ï¼‰
- [ ] åˆå§‹æ•°æ®å·²åŠ è½½ï¼ˆ`fixtures/encoding_profiles.json` å’Œ `fixtures/categories.json`ï¼‰
- [ ] è¶…çº§ç”¨æˆ·å·²åˆ›å»ºï¼ˆ`python manage.py createsuperuser`ï¼‰
- [ ] é™æ€æ–‡ä»¶å·²æ”¶é›†ï¼ˆ`python manage.py collectstatic --noinput`ï¼‰

**æ‰§è¡Œå‘½ä»¤ï¼ˆå¦‚æœæœªå®Œæˆï¼‰ï¼š**
```powershell
# 1. æ•°æ®åº“è¿ç§»
python manage.py migrate

# 2. åŠ è½½åˆå§‹æ•°æ®
python manage.py loaddata fixtures/encoding_profiles.json
python manage.py loaddata fixtures/categories.json

# 3. åˆ›å»ºè¶…çº§ç”¨æˆ·
python manage.py createsuperuser
# è¾“å…¥ç”¨æˆ·åã€é‚®ç®±ã€å¯†ç 

# 4. æ”¶é›†é™æ€æ–‡ä»¶
python manage.py collectstatic --noinput

# 5. éªŒè¯é…ç½®
python manage.py check
# åº”è¯¥çœ‹åˆ°ï¼šSystem check identified no issues (0 silenced).
```

---

## âœ… é˜¶æ®µå››ï¼šVue å‰ç«¯ç¯å¢ƒï¼ˆéœ€è¦å®Œæˆï¼‰

### 4.1 å‰ç«¯ç¯å¢ƒå˜é‡æ–‡ä»¶ âš ï¸ **é‡è¦ï¼šéœ€è¦åˆ›å»º**

**æ£€æŸ¥é¡¹ï¼š**
- [ ] `frontend-vue/.env.development` æ–‡ä»¶å·²åˆ›å»º

**å¦‚æœæœªåˆ›å»ºï¼Œåˆ›å»ºæ–‡ä»¶ `frontend-vue/.env.development`ï¼š**

```bash
# API åŸºç¡€åœ°å€
VITE_API_BASE=http://localhost:8000/api

# æ˜¯å¦ä½¿ç”¨ CSRF
VITE_USE_CSRF=false

# Token ç›¸å…³é…ç½®
VITE_ACCESS_HEADER=Authorization
VITE_ACCESS_PREFIX=Bearer

# Token åˆ·æ–°ç«¯ç‚¹
VITE_REFRESH_ENDPOINT=http://localhost:8000/api/v1/auth/refresh

# å‰ç«¯åœ°å€
VITE_FRONTEND_URL=http://localhost:8080

# åç«¯åœ°å€
VITE_BACKEND_URL=http://localhost:8000
```

### 4.2 å‰ç«¯ä¾èµ–å®‰è£…

**æ£€æŸ¥é¡¹ï¼š**
- [ ] `frontend-vue/node_modules` ç›®å½•å­˜åœ¨
- [ ] `frontend-vue/package.json` ä¸­çš„æ‰€æœ‰ä¾èµ–å·²å®‰è£…

**éªŒè¯å‘½ä»¤ï¼š**
```powershell
cd frontend-vue
npm list --depth=0
# åº”è¯¥æ˜¾ç¤ºæ‰€æœ‰ä¾èµ–åŒ…
```

**å¦‚æœæœªå®‰è£…ï¼Œè¿è¡Œï¼š**
```powershell
cd frontend-vue
npm install
# æˆ–ä½¿ç”¨å›½å†…é•œåƒåŠ é€Ÿï¼š
npm install --registry=https://registry.npmmirror.com
```

### 4.3 å‰ç«¯é…ç½®éªŒè¯

**æ£€æŸ¥é¡¹ï¼š**
- [ ] `frontend-vue/vite.config.ts` ä¸­çš„ä»£ç†é…ç½®æ­£ç¡®
- [ ] ä»£ç†ç›®æ ‡æŒ‡å‘ `http://localhost:8000`
- [ ] å‰ç«¯ç«¯å£è®¾ç½®ä¸º 8080

**éªŒè¯ `vite.config.ts` ä¸­çš„å…³é”®é…ç½®ï¼š**

```typescript
server: {
  port: 8080,
  proxy: {
    '/api': {
      target: 'http://localhost:8000',
      changeOrigin: true,
      secure: false,
    },
    // ... å…¶ä»–ä»£ç†é…ç½®
  }
}
```

---

## âœ… é˜¶æ®µäº”ï¼šæœåŠ¡å¯åŠ¨å‡†å¤‡

### 5.1 æœåŠ¡ä¾èµ–æ£€æŸ¥

**å¯åŠ¨å‰å¿…é¡»ç¡®ä¿ï¼š**
- [ ] PostgreSQL æœåŠ¡æ­£åœ¨è¿è¡Œ
- [ ] Redis æœåŠ¡æ­£åœ¨è¿è¡Œ
- [ ] æ‰€æœ‰é…ç½®æ–‡ä»¶å·²æ­£ç¡®è®¾ç½®

### 5.2 å¯åŠ¨è„šæœ¬æ£€æŸ¥

**æ£€æŸ¥é¡¹ï¼š**
- [ ] `start-dev.bat` æ–‡ä»¶å­˜åœ¨
- [ ] `start-dev.bat` ä¸­çš„è·¯å¾„æ­£ç¡®

**å¦‚æœä½¿ç”¨ `start-dev.bat`ï¼Œå®ƒä¼šè‡ªåŠ¨å¯åŠ¨ï¼š**
1. Celery Worker (çŸ­ä»»åŠ¡)
2. Celery Worker (é•¿ä»»åŠ¡)
3. Celery Beat
4. Django åç«¯
5. Vue å‰ç«¯

---

## ğŸ“ å®Œæ•´æ‰§è¡Œé¡ºåºï¼ˆå¿«é€Ÿå‚è€ƒï¼‰

### ç¬¬ä¸€æ¬¡è®¾ç½®ï¼ˆæŒ‰é¡ºåºæ‰§è¡Œï¼‰

```powershell
# 1. é…ç½®æ•°æ®åº“ï¼ˆå¦‚æœè¿˜æ²¡åšï¼‰
.\fix-postgres-password.bat

# 2. æ¿€æ´»è™šæ‹Ÿç¯å¢ƒ
.\venv\Scripts\Activate.ps1

# 3. æ•°æ®åº“è¿ç§»
python manage.py migrate

# 4. åŠ è½½åˆå§‹æ•°æ®
python manage.py loaddata fixtures/encoding_profiles.json
python manage.py loaddata fixtures/categories.json

# 5. åˆ›å»ºè¶…çº§ç”¨æˆ·
python manage.py createsuperuser

# 6. æ”¶é›†é™æ€æ–‡ä»¶
python manage.py collectstatic --noinput

# 7. éªŒè¯é…ç½®
python manage.py check

# 8. åˆ›å»ºå‰ç«¯ç¯å¢ƒå˜é‡æ–‡ä»¶ï¼ˆå¦‚æœä¸å­˜åœ¨ï¼‰
# åˆ›å»º frontend-vue/.env.developmentï¼ˆå‚è€ƒä¸Šé¢çš„å†…å®¹ï¼‰

# 9. å®‰è£…å‰ç«¯ä¾èµ–ï¼ˆå¦‚æœè¿˜æ²¡å®‰è£…ï¼‰
cd frontend-vue
npm install
cd ..

# 10. å¯åŠ¨æ‰€æœ‰æœåŠ¡
.\start-dev.bat
```

### æ—¥å¸¸å¼€å‘å¯åŠ¨

```powershell
# 1. ç¡®ä¿ PostgreSQL å’Œ Redis è¿è¡Œ
# 2. æ¿€æ´»è™šæ‹Ÿç¯å¢ƒ
.\venv\Scripts\Activate.ps1
# 3. å¯åŠ¨æ‰€æœ‰æœåŠ¡
.\start-dev.bat
```

---

## ğŸ” å¸¸è§é—®é¢˜æ’æŸ¥

### é—®é¢˜ 1ï¼šCORS é”™è¯¯ï¼ˆå‰ç«¯æ— æ³•è®¿é—®åç«¯ APIï¼‰

**ç—‡çŠ¶ï¼š**
- æµè§ˆå™¨æ§åˆ¶å°æ˜¾ç¤º CORS é”™è¯¯
- å‰ç«¯æ— æ³•è¿æ¥åˆ°åç«¯

**è§£å†³æ–¹æ³•ï¼š**
1. æ£€æŸ¥ `cms/local_settings.py` ä¸­çš„ CORS é…ç½®
2. ç¡®è®¤ `corsheaders` å·²æ·»åŠ åˆ° `INSTALLED_APPS`
3. ç¡®è®¤ CORS ä¸­é—´ä»¶å·²æ·»åŠ åˆ° `MIDDLEWARE`ï¼ˆå¿…é¡»åœ¨æœ€å‰é¢ï¼‰
4. é‡å¯ Django æœåŠ¡å™¨

**éªŒè¯å‘½ä»¤ï¼š**
```powershell
python manage.py check
# æ£€æŸ¥æ˜¯å¦æœ‰é…ç½®é”™è¯¯
```

### é—®é¢˜ 2ï¼šæ•°æ®åº“è¿æ¥å¤±è´¥

**ç—‡çŠ¶ï¼š**
- `python manage.py migrate` å¤±è´¥
- æç¤ºå¯†ç è®¤è¯å¤±è´¥

**è§£å†³æ–¹æ³•ï¼š**
```powershell
# è¿è¡Œä¿®å¤è„šæœ¬
.\fix-postgres-password.bat

# æˆ–æ‰‹åŠ¨é‡ç½®å¯†ç 
psql -U postgres -h localhost
ALTER USER mediacms WITH PASSWORD 'mediacms';
\q
```

### é—®é¢˜ 3ï¼šRedis è¿æ¥å¤±è´¥

**ç—‡çŠ¶ï¼š**
- Celery Worker æ— æ³•å¯åŠ¨
- æç¤º Redis è¿æ¥é”™è¯¯

**è§£å†³æ–¹æ³•ï¼š**
```powershell
# å¦‚æœä½¿ç”¨ WSL
wsl -e bash -c "sudo service redis-server start"

# å¦‚æœä½¿ç”¨ Memurai
# ç¡®ä¿ Memurai æœåŠ¡æ­£åœ¨è¿è¡Œï¼ˆç³»ç»Ÿæ‰˜ç›˜ï¼‰

# éªŒè¯
redis-cli ping
# åº”è¯¥è¿”å› PONG
```

### é—®é¢˜ 4ï¼šå‰ç«¯ä¾èµ–å®‰è£…å¤±è´¥

**ç—‡çŠ¶ï¼š**
- `npm install` å¤±è´¥
- æç¤ºä¾èµ–å†²çª

**è§£å†³æ–¹æ³•ï¼š**
```powershell
cd frontend-vue
# æ¸…é™¤ç¼“å­˜
npm cache clean --force
# åˆ é™¤ node_modules å’Œ package-lock.json
rm -r node_modules package-lock.json
# é‡æ–°å®‰è£…
npm install --legacy-peer-deps
```

### é—®é¢˜ 5ï¼šç«¯å£è¢«å ç”¨

**ç—‡çŠ¶ï¼š**
- Django æ— æ³•å¯åŠ¨ï¼ˆç«¯å£ 8000 è¢«å ç”¨ï¼‰
- Vue æ— æ³•å¯åŠ¨ï¼ˆç«¯å£ 8080 è¢«å ç”¨ï¼‰

**è§£å†³æ–¹æ³•ï¼š**
```powershell
# æ£€æŸ¥ç«¯å£å ç”¨
netstat -ano | findstr :8000
netstat -ano | findstr :8080

# ç»“æŸå ç”¨è¿›ç¨‹ï¼ˆæ›¿æ¢ PIDï¼‰
taskkill /PID <PID> /F
```

---

## âœ… æœ€ç»ˆéªŒè¯æ¸…å•

å¯åŠ¨æ‰€æœ‰æœåŠ¡åï¼ŒéªŒè¯ä»¥ä¸‹å†…å®¹ï¼š

### åç«¯éªŒè¯
- [ ] è®¿é—® `http://localhost:8000/admin`ï¼Œå¯ä»¥ç™»å½•
- [ ] è®¿é—® `http://localhost:8000/api/v1/`ï¼Œå¯ä»¥çœ‹åˆ° API æ–‡æ¡£
- [ ] Django æ§åˆ¶å°æ— é”™è¯¯
- [ ] Celery Worker æ­£å¸¸è¿è¡Œï¼ˆæ— é”™è¯¯æ—¥å¿—ï¼‰

### å‰ç«¯éªŒè¯
- [ ] è®¿é—® `http://localhost:8080`ï¼Œé¡µé¢æ­£å¸¸åŠ è½½
- [ ] æµè§ˆå™¨æ§åˆ¶å°æ—  CORS é”™è¯¯
- [ ] å¯ä»¥æ³¨å†Œæ–°ç”¨æˆ·
- [ ] å¯ä»¥ç™»å½•ç³»ç»Ÿ
- [ ] å¯ä»¥ä¸Šä¼ åª’ä½“æ–‡ä»¶ï¼ˆå¦‚æœåŠŸèƒ½å·²å®ç°ï¼‰

### åŠŸèƒ½éªŒè¯
- [ ] å‰åç«¯é€šä¿¡æ­£å¸¸
- [ ] API è¯·æ±‚æˆåŠŸï¼ˆæµè§ˆå™¨å¼€å‘è€…å·¥å…· Network æ ‡ç­¾ï¼‰
- [ ] è§†é¢‘æ’­æ”¾æ­£å¸¸ï¼ˆå¦‚æœåŠŸèƒ½å·²å®ç°ï¼‰

---

## ğŸ“š å‚è€ƒæ–‡æ¡£

- [Windowsæœ¬åœ°å¼€å‘ç¯å¢ƒæ­å»ºè®¡åˆ’.md](./Windowsæœ¬åœ°å¼€å‘ç¯å¢ƒæ­å»ºè®¡åˆ’.md)
- [ä¸‹ä¸€æ­¥æ“ä½œæŒ‡å—.md](./ä¸‹ä¸€æ­¥æ“ä½œæŒ‡å—.md)
- [å¼€å‘ç¯å¢ƒæ£€æŸ¥æ¸…å•.md](./å¼€å‘ç¯å¢ƒæ£€æŸ¥æ¸…å•.md)

---

**æœ€åæ›´æ–°ï¼š** è¯·ç¡®ä¿æ‰€æœ‰ âœ… æ ‡è®°çš„é¡¹ç›®éƒ½å·²å®Œæˆï¼Œç„¶åæ‰èƒ½å¯åŠ¨æœåŠ¡è¿›è¡Œå¼€å‘ã€‚

