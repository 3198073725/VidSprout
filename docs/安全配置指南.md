# MediaCMS å®‰å…¨é…ç½®æŒ‡å—

## âš ï¸ é‡è¦å®‰å…¨é—®é¢˜

åœ¨éƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒä¹‹å‰ï¼Œå¿…é¡»è§£å†³ä»¥ä¸‹å®‰å…¨é—®é¢˜ï¼š

### 1. SECRET_KEY é…ç½®

**å½“å‰é—®é¢˜**:
```python
# cms/settings.py
SECRET_KEY = "2dii4cog7k=5n37$fz)8dst)kg(s3&10)^qa*gv(kk+nv-z&cu"
```

**è§£å†³æ–¹æ¡ˆ**:

1. å®‰è£… `python-dotenv`:
```bash
pip install python-dotenv
```

2. åœ¨ `cms/settings.py` å¼€å¤´æ·»åŠ :
```python
from dotenv import load_dotenv
import os

# åŠ è½½ç¯å¢ƒå˜é‡
load_dotenv()

# ä½¿ç”¨ç¯å¢ƒå˜é‡
SECRET_KEY = os.environ.get('DJANGO_SECRET_KEY')
if not SECRET_KEY:
    raise ValueError("DJANGO_SECRET_KEY environment variable is not set")
```

3. ç”Ÿæˆæ–°çš„ SECRET_KEY:
```python
from django.core.management.utils import get_random_secret_key
print(get_random_secret_key())
```

4. åœ¨æ ¹ç›®å½•åˆ›å»º `.env` æ–‡ä»¶:
```bash
DJANGO_SECRET_KEY=ä½ ç”Ÿæˆçš„æ–°å¯†é’¥
```

5. ç¡®ä¿ `.env` åœ¨ `.gitignore` ä¸­ï¼ˆå·²åŒ…å«ï¼‰

### 2. æ•°æ®åº“å¯†ç å®‰å…¨

**å½“å‰é—®é¢˜**:
```python
# cms/local_settings.py
DATABASES = {
    "PASSWORD": "mediacms",  # ç¡¬ç¼–ç å¯†ç 
}
```

**è§£å†³æ–¹æ¡ˆ**:

ä½¿ç”¨ç¯å¢ƒå˜é‡æ›¿ä»£ç¡¬ç¼–ç å¯†ç ï¼š

```python
# cms/local_settings.py
from cms.env_settings import get_database_config

DATABASES = {
    'default': get_database_config()
}
```

åœ¨ `.env` æ–‡ä»¶ä¸­é…ç½®ï¼š
```bash
DB_NAME=mediacms
DB_USER=mediacms
DB_PASSWORD=ä½ çš„å¼ºå¯†ç 
DB_HOST=127.0.0.1
DB_PORT=5432
```

### 3. Redis å¯†ç å®‰å…¨

**å½“å‰é—®é¢˜**:
```python
# cms/local_settings.py
REDIS_PASSWORD = "root"  # ç¡¬ç¼–ç å¯†ç 
```

**è§£å†³æ–¹æ¡ˆ**:

```python
# cms/local_settings.py
from cms.env_settings import get_redis_location

REDIS_LOCATION = get_redis_location()
```

åœ¨ `.env` æ–‡ä»¶ä¸­é…ç½®ï¼š
```bash
REDIS_HOST=127.0.0.1
REDIS_PORT=6379
REDIS_PASSWORD=ä½ çš„Rediså¯†ç 
REDIS_DB=1
```

### 4. CORS é…ç½®

**å½“å‰é—®é¢˜**:
```python
# cms/local_settings.py
CORS_ALLOW_ALL_ORIGINS = True  # å¤ªå®½æ¾
```

**è§£å†³æ–¹æ¡ˆï¼ˆç”Ÿäº§ç¯å¢ƒï¼‰**:

```python
# ç§»é™¤ CORS_ALLOW_ALL_ORIGINS
# ä»…å…è®¸ç‰¹å®šåŸŸå
CORS_ALLOWED_ORIGINS = [
    "https://yourdomain.com",
    "https://www.yourdomain.com",
]
CORS_ALLOW_CREDENTIALS = True
```

**å¼€å‘ç¯å¢ƒ**ï¼ˆlocal_settings.pyï¼‰ï¼š
```python
if DEBUG:
    CORS_ALLOWED_ORIGINS = [
        "http://localhost:8088",
        "http://127.0.0.1:8088",
    ]
    CORS_ALLOW_CREDENTIALS = True
else:
    # ç”Ÿäº§ç¯å¢ƒé…ç½®
    CORS_ALLOWED_ORIGINS = [
        os.environ.get('FRONTEND_HOST', 'https://yourdomain.com'),
    ]
```

### 5. DEBUG æ¨¡å¼

**ç”Ÿäº§ç¯å¢ƒå¿…é¡»å…³é—­**:

```python
# åœ¨ .env ä¸­è®¾ç½®
DJANGO_DEBUG=False
```

```python
# cms/settings.py
DEBUG = get_bool_env('DJANGO_DEBUG', default=False)
```

### 6. ALLOWED_HOSTS

**ç”Ÿäº§ç¯å¢ƒå¿…é¡»é…ç½®**:

```python
# åœ¨ .env ä¸­è®¾ç½®
DJANGO_ALLOWED_HOSTS=yourdomain.com,www.yourdomain.com
```

```python
# cms/settings.py
ALLOWED_HOSTS = get_list_env('DJANGO_ALLOWED_HOSTS', default=['localhost', '127.0.0.1'])
```

## ğŸ“ å®Œæ•´é…ç½®ç¤ºä¾‹

### æ­¥éª¤ 1: å®‰è£…ä¾èµ–

```bash
pip install python-dotenv
pip freeze > requirements.txt
```

### æ­¥éª¤ 2: åˆ›å»º .env æ–‡ä»¶

ä» `env.example` å¤åˆ¶å¹¶ä¿®æ”¹ï¼š

```bash
cp env.example .env
# ç„¶åç¼–è¾‘ .env æ–‡ä»¶ï¼Œå¡«å…¥çœŸå®çš„é…ç½®å€¼
```

### æ­¥éª¤ 3: ä¿®æ”¹ settings.py

åœ¨ `cms/settings.py` å¼€å¤´æ·»åŠ ï¼š

```python
from dotenv import load_dotenv
from cms.env_settings import (
    get_env, 
    get_bool_env, 
    get_database_config,
    get_redis_location,
    get_email_config
)

# åŠ è½½ç¯å¢ƒå˜é‡
load_dotenv()

# ä½¿ç”¨ç¯å¢ƒå˜é‡
SECRET_KEY = get_env('DJANGO_SECRET_KEY', required=True)
DEBUG = get_bool_env('DJANGO_DEBUG', default=False)
```

### æ­¥éª¤ 4: ä¿®æ”¹ local_settings.py

```python
import os
from cms.env_settings import (
    get_env,
    get_bool_env,
    get_database_config,
    get_redis_location,
)

# åŸºç¡€é…ç½®
DEBUG = get_bool_env('DJANGO_DEBUG', default=True)
FRONTEND_HOST = get_env('FRONTEND_HOST', default='http://localhost:8088')

# æ•°æ®åº“é…ç½®
DATABASES = {
    'default': get_database_config()
}

# Redis é…ç½®
REDIS_LOCATION = get_redis_location()

# CORS é…ç½®
if DEBUG:
    CORS_ALLOWED_ORIGINS = [
        "http://localhost:8088",
        "http://127.0.0.1:8088",
    ]
    CORS_ALLOW_CREDENTIALS = True
else:
    CORS_ALLOWED_ORIGINS = [
        get_env('FRONTEND_HOST', 'https://yourdomain.com'),
    ]
    CORS_ALLOW_CREDENTIALS = True
    # ä¸è¦ä½¿ç”¨ CORS_ALLOW_ALL_ORIGINS
```

## ğŸ” ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²æ£€æŸ¥æ¸…å•

åœ¨éƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒä¹‹å‰ï¼Œè¯·ç¡®è®¤ï¼š

- [ ] `DEBUG = False`
- [ ] `SECRET_KEY` ä½¿ç”¨ç¯å¢ƒå˜é‡ï¼Œå¹¶ä¸”å·²æ›´æ”¹ä¸ºéšæœºç”Ÿæˆçš„å€¼
- [ ] æ•°æ®åº“å¯†ç ä½¿ç”¨ç¯å¢ƒå˜é‡ï¼Œå¹¶ä¸”æ˜¯å¼ºå¯†ç 
- [ ] Redis å¯†ç ä½¿ç”¨ç¯å¢ƒå˜é‡ï¼Œå¹¶ä¸”å·²è®¾ç½®
- [ ] `ALLOWED_HOSTS` é…ç½®äº†æ­£ç¡®çš„åŸŸå
- [ ] CORS é…ç½®ä»…å…è®¸ä¿¡ä»»çš„åŸŸå
- [ ] `.env` æ–‡ä»¶åœ¨ `.gitignore` ä¸­
- [ ] `local_settings.py` åœ¨ `.gitignore` ä¸­
- [ ] æ‰€æœ‰ `console.log` è°ƒè¯•è¯­å¥å·²ç§»é™¤
- [ ] ç”Ÿäº§ç¯å¢ƒä½¿ç”¨ HTTPS
- [ ] `CSRF_COOKIE_SECURE = True`
- [ ] `SESSION_COOKIE_SECURE = True`
- [ ] é…ç½®äº†é”™è¯¯ç›‘æ§ï¼ˆå¦‚ Sentryï¼‰
- [ ] é…ç½®äº†æ—¥å¿—è®°å½•
- [ ] æ•°æ®åº“å¤‡ä»½ç­–ç•¥å·²è®¾ç½®

## ğŸ›¡ï¸ é¢å¤–å®‰å…¨å»ºè®®

1. **ä½¿ç”¨å¼ºå¯†ç **
   - æ•°æ®åº“å¯†ç è‡³å°‘ 16 ä¸ªå­—ç¬¦
   - Redis å¯†ç è‡³å°‘ 32 ä¸ªå­—ç¬¦
   - åŒ…å«å¤§å°å†™å­—æ¯ã€æ•°å­—å’Œç‰¹æ®Šå­—ç¬¦

2. **å®šæœŸæ›´æ–°ä¾èµ–**
   ```bash
   pip list --outdated
   pip install --upgrade package-name
   ```

3. **å¯ç”¨ HTTPS**
   - ä½¿ç”¨ Let's Encrypt å…è´¹è¯ä¹¦
   - é…ç½® SSL/TLS

4. **é™åˆ¶æ–‡ä»¶ä¸Šä¼ å¤§å°**
   ```python
   # åœ¨ settings.py ä¸­
   DATA_UPLOAD_MAX_MEMORY_SIZE = 50 * 1024 * 1024  # 50MB
   FILE_UPLOAD_MAX_MEMORY_SIZE = 50 * 1024 * 1024
   ```

5. **é…ç½®å®‰å…¨å¤´**
   ```python
   # åœ¨ settings.py ä¸­
   SECURE_BROWSER_XSS_FILTER = True
   SECURE_CONTENT_TYPE_NOSNIFF = True
   X_FRAME_OPTIONS = 'DENY'
   ```

6. **ä½¿ç”¨ä¸“ç”¨çš„æ•°æ®åº“ç”¨æˆ·**
   - ä¸è¦ä½¿ç”¨ root æˆ– postgres ç”¨æˆ·
   - åªæˆäºˆå¿…è¦çš„æƒé™

7. **å®šæœŸå®‰å…¨å®¡è®¡**
   ```bash
   # æ£€æŸ¥å·²çŸ¥æ¼æ´
   pip install safety
   safety check
   ```

## ğŸ“š å‚è€ƒèµ„æº

- [Django Security Checklist](https://docs.djangoproject.com/en/5.0/howto/deployment/checklist/)
- [OWASP Top 10](https://owasp.org/www-project-top-ten/)
- [Django Security Best Practices](https://docs.djangoproject.com/en/5.0/topics/security/)

