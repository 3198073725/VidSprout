{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    {% block head %}

        <title>{% block headtitle %}{{PORTAL_NAME}}{% endblock headtitle %}</title>

        {% include "common/head-meta.html" %}

        {% block headermeta %}

        <meta property="og:title" content="{{PORTAL_NAME}}">
        <meta property="og:type" content="website">

        {%endblock headermeta %}

        {% block externallinks %}{% endblock externallinks %}

        {% include "common/head-links.html" %}

        {% block topimports %}{%endblock topimports %}

        {% include "config/index.html" %}


        {% if not USE_ROUNDED_CORNERS %}
        <style>
            .viewer-container .player-container, .item-thumb, a.item-thumb {
                border-radius: revert !important;
            }
        </style>
        {% endif %}

        {# Vue 3 集成 - 开发模式使用 Vite 开发服务器，生产模式使用静态文件 #}
        {% if DEBUG %}
            {# 开发模式：使用 Vite 开发服务器 #}
            <script type="module" src="http://localhost:8088/@vite/client"></script>
        {% else %}
            {# 生产模式：使用编译后的 CSS（需要先构建 Vue 前端） #}
            {% if vue_css %}
                <link rel="stylesheet" href="{% static vue_css %}">
            {% endif %}
        {% endif %}

        {# 传递 Django 上下文到 Vue #}
        <script>
            window.__INITIAL_STATE__ = {
                portalName: "{{ PORTAL_NAME }}",
                frontendHost: "{{ FRONTEND_HOST }}",
                useRoundedCorners: {{ USE_ROUNDED_CORNERS|yesno:"true,false" }},
                loadFromCdn: {{ LOAD_FROM_CDN|yesno:"true,false" }},
                user: {% if user.is_authenticated %}{
                    id: {{ user.id }},
                    username: "{{ user.username }}",
                    email: "{{ user.email }}",
                    isStaff: {{ user.is_staff|yesno:"true,false" }},
                    isSuperuser: {{ user.is_superuser|yesno:"true,false" }},
                }{% else %}null{% endif %},
                csrfToken: "{{ csrf_token }}",
            };
        </script>
        
    {% endblock head %}

</head>

<body>

    {% block beforecontent %}{% endblock %}

    {# Vue 3 挂载点 - 如果使用 Vue 前端，替换原有内容 #}
    <div id="app"></div>

    {# 原有 Django 模板内容（用于兼容 React 前端） #}
    <div class="page-main-wrap" style="display: none;">
        {% include "messages.html" %}
        {% block content %}{% endblock %}
    </div>

    {% block aftercontent %}{% endblock %}

    {% if LOAD_FROM_CDN %}
    <script src="https://vjs.zencdn.net/7.20.2/video.min.js"></script>
    {% else %}
    <script src="{% static "lib/video-js/7.20.2/video.min.js" %}"></script>
    {% endif %}

    {% block externalscripts %}{% endblock externalscripts %}

    {% include "common/body-scripts.html" %}

    {# Vue 3 JS - 开发模式使用 Vite，生产模式使用编译后的文件 #}
    {% if DEBUG %}
        {# 开发模式：从 Vite 开发服务器加载 #}
        <script type="module" src="http://localhost:8088/src/main.ts"></script>
    {% else %}
        {# 生产模式：使用编译后的 JS（需要先构建 Vue 前端） #}
        {% if vue_js %}
            <script type="module" src="{% static vue_js %}"></script>
        {% endif %}
    {% endif %}

    {% block bottomimports %}{% endblock bottomimports %}

</body>

</html>
